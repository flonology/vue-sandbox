<script type="text/x-template" id="select-list-tpl">
    <div>
        <div class="search__container">
            <input class="search__input input--standard"
                placeholder="Searchâ€¦"
                v-model="searchString"
                v-on:input="selectNothing"
                v-on:keydown.down.prevent="selectNext"
                v-on:keydown.up.prevent="selectPrev"
                v-on:keyup.enter="$emit('show-list-entry', list.getCurrent())"
                tabindex="1" />

            <button class="button" v-on:click="$emit('add-entry')">add</button>
        </div>

        <div class="search__entryIndicator">
            {{ list.entries.length }} of {{ creds.length }} entries
            <br>{{ highlightFirstEntry }}
            <span
                v-on:click="showAll"
                class="search__showAll"
                v-bind:class="{ 'search__showAll--hidden': hideShowAll }">SHOW ALL</span>
        </div>

        <ul class="list">
            <li class="list__entry"
                v-for="listEntry in list.entries"
                v-bind:key="listEntry.id"
                v-on:click="$emit('show-list-entry', listEntry)"
                v-bind:class="{ 'list__entry--selected': listEntry.selected }">
                {{ listEntry.title }}<br>
                {{ listEntry.url }}
            </li>
        </ul>
    </div>
</script>


<script>
Vue.component('select-list', {
    template: '#select-list-tpl',
    props: ['creds', 'highlightFirstEntry'],
    data: function() {
        return {
            showMaxListEntries: 25,
            searchString: '',
            numSearchResults: 0
        };
    },
    computed: {
        list: function() {
            var creds = My.CredFilter(this.creds).search(this.searchString);
            this.numSearchResults = creds.length;

            if (this.showMaxListEntries) {
                creds = creds.slice(0, this.showMaxListEntries);
            }

            return My.SelectList(creds);
        },
        hideShowAll: function() {
            if (this.showMaxListEntries == null) {
                return true;
            }

            if (this.numSearchResults <= this.showMaxListEntries) {
                return true;
            }

            return false;
        }
    },
    mounted: function() {
    },
    methods: {
        showAll: function(event) {
            this.showMaxListEntries = null;
        },
        selectNext: function(event) {
            this.list.selectNext();
        },
        selectPrev: function(event) {
            this.list.selectPrev();
        },
        selectNothing: function(event) {
            this.list.selectNothing();
        }
    }
})
</script>
