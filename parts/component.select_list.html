<script type="text/x-template" id="select-list-tpl">
    <div>
        <div class="search__container">
            <input class="search__input input--standard"
                placeholder="Searchâ€¦"
                v-model="searchString"
                v-on:input="selectNothing"
                v-on:keydown.down.prevent="selectNext"
                v-on:keydown.up.prevent="selectPrev"
                v-on:keyup.enter="$emit('show-list-entry', list.getCurrent())"
                tabindex="1" />

            <button class="button" v-on:click="$emit('add-entry')">add</button>
        </div>

        <ul class="list">
            <li class="list__entry"
                v-for="listEntry in list.entries"
                v-bind:key="listEntry.id"
                v-on:click="$emit('show-list-entry', listEntry)"
                v-bind:class="{ 'list__entry--selected': listEntry.selected }">
                {{ listEntry.title }}<br>
                {{ listEntry.url }}
            </li>
        </ul>
    </div>
</script>


<script>
Vue.component('select-list', {
    template: '#select-list-tpl',
    props: ['creds'],
    data: function() {
        return {
            searchString: ''
        };
    },
    computed: {
        list: function() {
            var creds = this.creds;
            var search = this.searchString.toLowerCase();

            if (search.length > 2) {
                var searchStrings = search.split(' ');

                creds = creds.filter(function(entry) {
                    var title = entry.title.toLowerCase();
                    var url = entry.url.toLowerCase();
                    var found = true;

                    for (var i = 0; i < searchStrings.length; i++) {
                        var searchString = searchStrings[i];
                        var foundPart = false;

                        if (searchString == '') {
                            continue;
                        }

                        found = found && (
                            title.indexOf(searchString) !== -1 ||
                            url.indexOf(searchString) !== -1
                        );
                    };

                    return found;
                });
            }

            return My.SelectList(creds);
        }
    },
    mounted: function() {
    },
    methods: {
        selectNext: function(event) {
            this.list.selectNext();
        },
        selectPrev: function(event) {
            this.list.selectPrev();
        },
        selectNothing: function(event) {
            this.list.selectNothing();
        }
    }
})
</script>
