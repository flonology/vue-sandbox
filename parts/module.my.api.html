<script>
    My.Api = function() {
        var self = {
            apiKey: null
        };

        self.config = function() {
            return {
                headers: {'Authorization': 'Bearer ' + self.apiKey}
            };
        };

        var login = function(username, password, successCall, errorCall) {
            var url = My.Config.api.baseUrl + My.Config.api.routes.login;

            axios.post(url, {
                username: username,
                password: password
            })
            .then(function (response) {
                self.apiKey = response.data;
                successCall();
            })
            .catch(function (error) {
                console.log(error);
                errorCall();
            });
        };


        var register = function(username, password, successCall, errorCall) {
            var url = My.Config.api.baseUrl + My.Config.api.routes.register;

            axios.post(url, {
                username: username,
                password: password
            })
            .then(function (response) {
                successCall();
            })
            .catch(function (error) {
                errorCall(error.response);
            });
        };


        var getCreds = function(successCall, errorCall) {
            var url = My.Config.api.baseUrl + My.Config.api.routes.creds;

            axios
                .get(url, self.config())
                .then(function (response) {
                    successCall(response.data.data);
                })
                .catch(function (error) {
                    console.log(error);
                    errorCall();
                });
        };


        var createCred = function(encryptedCred, successCall, errorCall) {
            var url = My.Config.api.baseUrl + My.Config.api.routes.creds;

            axios
                .post(url, { 'cred_item': encryptedCred }, self.config())
                .then(function (response) {
                    successCall(response.data.data.id);
                })
                .catch(function (error) {
                    console.log(error);
                    errorCall();
                });
        };


        var updateCred = function(id, encryptedCred, successCall, errorCall) {
            var url
                = My.Config.api.baseUrl
                + My.Config.api.routes.creds + '/'
                + id;

            axios
                .put(
                    url, { 'cred_item': encryptedCred }, self.config()
                )
                .then(function (response) {
                    successCall(response.data.data.id);
                })
                .catch(function (error) {
                    console.log(error);
                    errorCall();
                });
        };


        return {
            login: login,
            register: register,
            getCreds: getCreds,
            createCred: createCred,
            updateCred: updateCred
        };
    };
</script>
